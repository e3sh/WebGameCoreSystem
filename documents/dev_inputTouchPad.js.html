<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dev/inputTouchPad.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dev/inputTouchPad.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>﻿// touchPadControl 
//**************************************************************
/**
 * touchPadControl
 * @class
 * @classdesc
 * タッチパッド（またはタッチスクリーン）からの入力を管理します。&lt;br>\
 * タッチ開始、移動、終了、キャンセルイベントを処理し、&lt;br>\
 * 複数のタッチポイントの位置を追跡します。
 * @todo スワイプやピンチインアウトの検出
 */
class inputTouchPad {
    /**
     * @constructor
     * @param {string} canvas_id CanvasId
     * @example
     * GameCoreでCanvasIdが指定されます。
     */
    constructor(canvas_id) {

        let pos = [];

        let tr = { x: 1, y: 1, offset_x: 0 };

        let el = document.getElementById(canvas_id);
        //let cvs = document;
        //this.o_Left = el.width ;//offsetLeft;
        //this.o_Top = el.height;//offsetTop;
        let viewf = false;

        //iPodTouch用(マルチポイントタッチ)
        el.addEventListener('touchstart', ViewTrue,
            { passive: false });
        el.addEventListener('touchmove', ViewTrue,
            { passive: false });
        el.addEventListener('touchend', ViewFalse,
            { passive: false });
        el.addEventListener('touchcancel', ViewFalse,
            { passive: false });

        function ViewTrue(e) {
            e.preventDefault();
            touchposget(e);
            viewf = true;
        }

        function ViewFalse(e) {
            e.preventDefault();
            touchposget(e);
            viewf = false;
        }

        /**
         * @method
         * @param {GameCore} g GameCoreインスタンス
         * @description
         * フルスクリーンモードかどうかに応じてタッチ座標の変換を調整します。&lt;br>\
         * これにより、実際の画面解像度と描画Canvasの解像度が異なる場合でも、&lt;br>\
         * 正確なタッチ位置をゲーム内で取得できます。
         */
        this.mode = function (g) {

            if (document.fullscreenElement) {
                let cw = el.clientWidth; //document.documentElement.clientWidth;
                let ch = el.clientHeight; //document.documentElement.clientHeight;
                let pixr = window.devicePixelRatio;

                let scw = g.systemCanvas.width;
                let sch = g.systemCanvas.height;

                let rt = ch / sch;

                tr.x = rt; tr.y = rt; tr.offset_x = ((scw * rt) - cw) / rt / 2;
            } else {
                tr.x = 1; tr.y = 1; tr.offset_x = 0;
            }
        };

        function touchposget(event) {

            pos = [];

            if (event.touches.length > 0) {
                for (let i = 0; i &lt; event.touches.length; i++) {
                    let t = event.touches[i];

                    pos[i] = {};

                    pos[i].x = (t.pageX / tr.x) + tr.offset_x;
                    pos[i].y = (t.pageY / tr.y);
                    pos[i].id = t.identifier;
                    //pos[i].count = 0;//work
                }
            }
        }

        /**
         * @typedef {object} touchpadState タッチパネル状態
         * @property {object[]} pos
         * @property {number} pos[].x x座標　
         * @property {number} pos[].y y座標
         * @property {number} pos[].id touch.identifier
         * @see https://developer.mozilla.org/ja/docs/Web/API/Touch
         * 
         */
        /**
         * @method
         * @returns {touchpadState} タッチパネル状態 
         * @description
         * 現在のタッチ入力状態を返します。&lt;br>\
         * 複数のタッチポイントがある場合、各ポイントのX、Y座標と&lt;br>\
         * IDを含む配列として提供されます。
         */
        this.check = function () {
            let state = {};

            state.pos = pos;
            return state;
        };

        /**
         * @method
         * @returns {touchpadState} タッチパネル状態
         * @description
         * 最後に記録されたタッチ入力状態を、値をリセットせずに返します。&lt;br>\
         * このメソッドは、前フレームの状態を参照したい場合や、&lt;br>\
         * 値のリセットが不要な場合に利用されます。
         */
        this.check_last = function () {
            let state = {};

            state.pos = pos;
            return state;
        };

        /**
         * @method
         * @param {DisplayControl} context 表示するDisplayControlを指定
         * @description
         * 現在アクティブなタッチポイントの位置に視覚的な円形インジケータを描画します。&lt;br>\
         * デバッグや、タッチ操作のフィードバックを表示したい場合に利用でき、&lt;br>\
         * 描画機能を持つオブジェクトを`putFunc`で登録します。
         */
        this.draw = function (context) {

            if (!viewf) return;

            let st = this.check_last();

            let s = "p " + pos.length + "/";

            for (let j = 0; j &lt;= pos.length - 1; j++) {
                s = s + "b" + j + " ";

                let cl = {};
                cl.x = pos[j].x;
                cl.y = pos[j].y;
                cl.r = 16;
                cl.draw = function (device) {
                    let context = device;

                    context.beginPath();
                    context.arc(this.x, this.y, this.r, 0, 2 * Math.PI, true);
                    //context.fillStyle = "orange";
                    //context.fill();
                    context.strokeStyle = "white";
                    context.lineWidth = 2;
                    context.stroke();
                };
                context.putFunc(cl);

            }
            //context.fillStyle = "green";
            //context.print(s, 12, 16);
            // 移動した座標を取得
        };
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Beepcore.html">Beepcore</a></li><li><a href="Beepcore.noteClass.html">noteClass</a></li><li><a href="DisplayControl.html">DisplayControl</a></li><li><a href="DisplayControl.offScreenTypeC.html">offScreenTypeC</a></li><li><a href="GameAssetManager.html">GameAssetManager</a></li><li><a href="GameAssetManager.audioAsset.html">audioAsset</a></li><li><a href="GameAssetManager.imageAsset.html">imageAsset</a></li><li><a href="GameCore.html">GameCore</a></li><li><a href="GameCore.bench.html">bench</a></li><li><a href="GameSpriteControl.html">GameSpriteControl</a></li><li><a href="GameSpriteControl.SpItem.html">SpItem</a></li><li><a href="GameSpriteFontControl.html">GameSpriteFontControl</a></li><li><a href="GameTask.html">GameTask</a></li><li><a href="GameTaskControl.html">GameTaskControl</a></li><li><a href="SpItem.html">SpItem</a></li><li><a href="audioAsset.html">audioAsset</a></li><li><a href="bench.html">bench</a></li><li><a href="fontPrintControl.html">fontPrintControl</a></li><li><a href="imageAsset.html">imageAsset</a></li><li><a href="inputGamepad.html">inputGamepad</a></li><li><a href="inputKeyboard.html">inputKeyboard</a></li><li><a href="inputMouse.html">inputMouse</a></li><li><a href="inputTouchPad.html">inputTouchPad</a></li><li><a href="inputVirtualPad.html">inputVirtualPad</a></li><li><a href="noteClass.html">noteClass</a></li><li><a href="offScreenTypeC.html">offScreenTypeC</a></li><li><a href="soundControl.html">soundControl</a></li><li><a href="viewport.html">viewport</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue Aug 19 2025 15:22:23 GMT+0900 (日本標準時)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
